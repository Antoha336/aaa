SELECT 
    t.name AS team_name,
    t.team_id,
    m.match_date,
    m.goals_scored,
    LAG(m.goals_scored) OVER (PARTITION BY t.team_id ORDER BY m.match_date) AS prev_goals,
    m.goals_scored - LAG(m.goals_scored) OVER (PARTITION BY t.team_id ORDER BY m.match_date) AS goals_diff
FROM (
    SELECT
        match_id,
        match_date,
        home_team_id AS team_id,
        home_score AS goals_scored
    FROM kr1_Matches
    
    UNION ALL
    
    SELECT
        match_id,
        match_date,
        away_team_id AS team_id,
        away_score AS goals_scored
    FROM kr1_Matches
) m
JOIN kr1_Teams t ON t.team_id = m.team_id
ORDER BY t.name, m.match_date;
